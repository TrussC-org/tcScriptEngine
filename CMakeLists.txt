cmake_minimum_required(VERSION 3.20)

# TRUSSC_DIR is provided by CMakePresets.json (generated by projectGenerator)
# For CI/manual builds without presets, fallback to relative path
if(NOT DEFINED TRUSSC_DIR)
    set(TRUSSC_DIR "${CMAKE_CURRENT_SOURCE_DIR}/../../../trussc")
endif()

include(${TRUSSC_DIR}/cmake/trussc_app.cmake)

trussc_app()

# ChaiScript requires exceptions
if(EMSCRIPTEN)
    target_compile_options(${PROJECT_NAME} PRIVATE -fexceptions)
    target_link_options(${PROJECT_NAME} PRIVATE -fexceptions)
    # Export functions for JS interop
    target_link_options(${PROJECT_NAME} PRIVATE
        -sEXPORTED_FUNCTIONS=['_main','_updateScriptCode','_getScriptError']
        -sEXPORTED_RUNTIME_METHODS=['ccall','cwrap']
    )
endif()
